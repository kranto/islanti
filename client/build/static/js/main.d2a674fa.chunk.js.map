{"version":3,"sources":["Lobby.js","GameStart.js","ScoreBoard.js","Hand.js","cards.js","game.js","CardTable.js","GameRoom.js","StateManager.js","App.js","serviceWorker.js","index.js"],"names":["readFromLocalStorage","stringItem","window","localStorage","getItem","JSON","parse","writeToLocalStorage","object","setItem","stringify","Lobby","onCodeChanged","event","setState","code","target","value","errorMsg","onCodeReady","loading","props","stateManager","findGame","state","result","ok","phase","game","gameCreatedBy","createdBy","gameCreatedAt","createdAt","msg","onNewGameClicked","newGame","onNickChanged","nick","onNickReady","saveState","createGame","joinGame","participation","token","joinedGame","undefined","resumeParticipation","validating","participationFromUri","query","location","search","substring","length","split","map","q","key","localState","nickEntered","console","log","this","lobbyReady","goToGame","savedState","className","style","height","display","flexFlow","justifyContent","alignItems","id","htmlFor","autoFocus","type","maxLength","minLength","onChange","disabled","visibility","onClick","role","Component","GameStart","renderTableData","players","p","i","name","score","rounds","rs","j","roundName","s","isDealer","round","total","ts","startGame","onStartGame","started","exitGame","confirm","onExitGame","abandonGame","onAbandonGame","imOwner","minWidth","locked","Hand","getClasses","classes","selected","error","cards","opt","cardSize","width","spacing","mouseEvent","ev","card","$","data","container","handler","func","call","context","Card","suit","rank","back","table","init","Container","Deck","options","prototype","el","addClass","appendTo","html","css","setTimeout","reveal","faceUp","click","draggable","stack","containment","start","dragging","stop","cardback","find","attr","pullUp","pixels","top","parseInt","transition","showCard","toggleClass","hideCard","position","rect","elementRect","extend","obj","prop","addCard","addCards","removeCard","push","isDraggable","setElementWidth","indexOf","splice","maxWidth","element","_click","getNewIndex","newX","x","filter","c","moveCardToTarget","currTop","targetTop","Math","abs","currLeft","targetLeft","sign","distance","max","left","render","speed","calcPosition","me","flip","immediate","callback","topCard","boundingRect","y","centerX","centerY","pad","desiredWidth","calcSpacing","cardWidth","jQuery","require","deck","discardPile","allCards","otherPlayers","myClosedHandSections","myOpenHandSections","createNewSection","index","section","droppable","accept","greedy","drop","ui","movedCard","hand","handIndex","newOrder","sendAction","order","createNewOpenHand","playerId","handArray","selector","openhand","cardElement","accepts","acc","r","firstHalf","dropIndex","player","updateContainer","servercards","reverse","servercard","b","findCard","forEach","populateState","imGuest","myhands","open","each","pile","closedhand","closed","otherPlayer","i2","can","discard","complete","action","params","_stateManager","resize","pick","fromDeck","buy","sell","firstCardInNewSection","newSection","stateChange","CardTable","onStateChange","getState","validateSelection","sel","selection","reduce","sets","validity","straights","isFreestyle","expectedSets","expectedStraights","flat","valid","onSectionClicked","selectionOk","opening","gameInitialized","subscribeTo","unsubscribe","canStart","inTurn","h","sections","selectedIndices","myTurn","playerInTurn","buying","winner","deal","show","startOpening","confirmOpening","cancelOpening","startNextRound","onNextRound","endGame","onEndGame","createPlayers","roundNumber","createInstructions","createControls","createMySections","GameRoom","roundState","onScoreBoardClosed","sendGameAction","StateManager","endpoint","hostname","lobbyName","lobby","close","socketIOClient","on","connected","emit","gameToken","credentials","args","authenticate","requestFullState","authenticated","status","CustomEvent","detail","document","dispatchEvent","indices","eventType","addEventListener","removeEventListener","App","initGame","inLobby","inGame","myName","resetState","closeGame","decodeURIComponent","initLobby","title","Boolean","match","ReactDOM","StrictMode","getElementById","navigator","serviceWorker","ready","then","registration","unregister","catch","message"],"mappings":"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","file":"static/js/main.d2a674fa.chunk.js","sourcesContent":["import React, { Component } from \"react\";\n\nlet readFromLocalStorage = () => {\n  let stringItem = window.localStorage.getItem('IslantiState') || \"{}\";\n  return JSON.parse(stringItem);\n}\n\nlet writeToLocalStorage = (object) => {\n  window.localStorage.setItem('IslantiState', JSON.stringify(object));\n}\n\nclass Lobby extends Component {\n\n  constructor() {\n    super();\n\n    let participationFromUri = \"\";\n    let query = window.location.search.substring(1);\n    if (query.length > 0) {\n      query.split(\"&\").map(q => {\n        let [key, value] = q.split(\"=\");\n        if (key === \"pid\") participationFromUri = value;\n      });\n    }\n\n    let localState = readFromLocalStorage() || {};\n    let participation = participationFromUri ? participationFromUri : localState.participation;\n\n    this.state = {\n      game: null,\n      participation: participation,\n      phase: participation ? 3 : 1,\n      joinedGame: false,\n      code: \"\",\n      errorMsg: \"\",\n      newGame: false,\n      loading: false,\n      nickEntered: false,\n      nick: localState.nick || \"\"\n    };\n\n    console.log('entered lobby')\n  }\n\n  static resetState() {\n    let state = readFromLocalStorage();\n    state = {...state, game: undefined, participation: undefined};\n    writeToLocalStorage(state);\n  }\n\n  componentDidUpdate() {\n    if (!this.state) return;\n    if (this.state.phase === 3 && this.props.lobbyReady && !this.state.joinedGame) {\n      this.resumeParticipation();\n      this.setState({phase: 1});\n    } else if (this.state.joinedGame) {\n      this.props.goToGame(this.state.game, this.state.participation);\n    }\n  }\n\n  saveState() {\n    let savedState = {nick: this.state.nick, game: this.state.game, participation: this.state.participation};\n    writeToLocalStorage(savedState);\n  }\n\n  onCodeChanged = (event) => {\n    this.setState({ code: event.target.value, errorMsg: \"\" });\n  }\n\n  onCodeReady = () => {\n    this.setState({ loading: true });\n    this.props.stateManager.findGame(this.state.code, (result) => {\n      if (result.ok) {\n        this.setState({loading: false, phase: 2, game: result.game, gameCreatedBy: result.createdBy, gameCreatedAt: result.createdAt});\n      } else {\n        this.setState({loading: false, code: \"\", phase: 1, errorMsg: result.msg});\n      }\n    });\n  }\n\n  onNewGameClicked = () => {\n    this.setState({ newGame: true, phase: 2 });\n  }\n\n  onNickChanged = (event) => {\n    this.setState({ nick: event.target.value });\n  }\n\n  onNickReady = () => {\n    this.setState({ loading: true });\n    this.saveState();\n    if (this.state.newGame) {\n      this.createGame();\n    } else {\n      this.joinGame();\n    }\n  }\n\n  createGame = () => {\n    this.props.stateManager.createGame(this.state.nick, (result) => {\n      if (result.ok) {\n        this.setState({loading: false, participation: result.participation.token, nick: result.participation.nick, game: result.game, phase: 3, joinedGame: true});\n      } else {\n        this.setState({loading: false, errorMsg: result.msg, code: \"\", participation: undefined, game: undefined, phase: 1, joinedGame: false});\n      }\n      this.saveState();\n    });\n  }\n\n  joinGame = () => {\n    this.props.stateManager.joinGame(this.state.game, this.state.nick, (result) => {\n      if (result.ok) {\n        this.setState({loading: false, participation: result.participation.token, nick: result.participation.nick, game: result.game, phase: 3, joinedGame: true});\n      } else {\n        this.setState({loading: false, errorMsg: result.msg, code: \"\", participation: undefined, game: undefined, phase: 1, joinedGame: false});\n      }\n      this.saveState();\n    });\n  }\n\n  resumeParticipation = () => {\n    if (this.validating) return;\n    this.validating = true;\n    this.setState({loading: true});\n    this.props.stateManager.resumeParticipation(this.state.participation, (result) => {\n      if (result.ok) {\n        this.setState({loading: false, participation: result.participation.token, game: result.game, nick: result.participation.nick, phase: 3, joinedGame: true});\n      } else {\n        this.setState({loading: false, code: \"\", participation: undefined, game: undefined, phase: 1, joinedGame: false});\n      }\n      this.saveState();\n      this.validating = false;\n    });\n  }\n\n  render() {\n    if (!this.state) return \"\";\n    return (\n      <div className=\"Lobby\">\n        {this.state.phase !== 1 ? \"\" :\n          <div style={{ height: \"100%\", display: \"flex\", flexFlow: \"column nowrap\", justifyContent: \"space-around\", alignItems: \"center\" }}>\n            <div></div>\n            <div id=\"enterCodeView\">\n              <h1>Liity peliin</h1>\n              <div className=\"form-group\">\n                <label htmlFor=\"inputGameCode\">Osallistumiskoodi</label>\n                <input autoFocus type=\"text\" className=\"form-control\" id=\"inputGameCode\" maxLength=\"4\" minLength=\"4\" value={this.state.code} onChange={this.onCodeChanged} disabled={this.state.loading} />\n                <small id=\"gameHelp\" className=\"form-text text-muted text-gray\">Syötä saamasi nelinumeroinen osallistumiskoodi</small>\n                <div style={{ visibility: this.state.code.length === 4 ? \"visible\" : \"hidden\" }}>\n                  <button type=\"button\" className=\"btn btn-dark\" onClick={this.onCodeReady} disabled={this.state.loading}>\n                    Osallistu...\n                  </button>\n                  <br />\n                  <div className=\"spinner-border spinner-border-sm\" role=\"status\" style={{ visibility: this.state.loading ? \"visible\" : \"hidden\" }}>\n                    <span className=\"sr-only\">Ladataan...</span>\n                  </div>\n                </div>\n              </div>\n              <div>{this.state.errorMsg}<span>&nbsp;</span></div>\n            </div>\n            <div id=\"newGame\" style={{ visibility: this.state.code.length === 0 ? \"visible\" : \"hidden\" }}>\n              <button type=\"button\" className=\"btn btn-dark\" onClick={this.onNewGameClicked} disabled={this.state.code.length > 0}>\n                Tai aloita uusi peli...\n            </button>\n            </div>\n          </div>\n        }\n        {this.state.phase !== 2 ? \"\" :\n          <div>\n            {this.state.newGame ?\n              <h1>Uusi peli</h1>\n              :\n              <div>\n                <h1>Liity peliin <small>{this.state.code}</small></h1>\n                <small className=\"text-muted text-gray\">Pelin aloitti {this.state.gameCreatedBy}</small>\n              </div>\n            }\n            <div className=\"form-group\">\n              <label htmlFor=\"inputNick\">Anna nimimerkkisi</label>\n              <input autoFocus type=\"text\" className=\"form-control\" id=\"inputNick\" minLength=\"1\" maxLength=\"20\" value={this.state.nick} onChange={this.onNickChanged} />\n              <small id=\"nickHelp\" className=\"form-text text-muted text-gray\">Voit käyttää eri nimimerkkejä eri peleissä</small>\n              <button type=\"button\" className=\"btn btn-dark\" onClick={this.onNickReady} style={{ visibility: this.state.nick.length > 0 ? \"visible\" : \"hidden\" }}>{this.state.newGame ? \"Aloita uusi peli\" : \"Liity peliin\"}</button>\n              <div className=\"spinner-border spinner-border-sm\" role=\"status\" style={{ visibility: this.state.loading ? \"visible\" : \"hidden\" }}>\n                <span className=\"sr-only\">Ladataan...</span>\n              </div>\n            </div>\n          </div>\n        }\n      </div>\n    );\n  }\n}\n\nexport default Lobby;\n","\nimport React, { Component } from \"react\";\n\nclass GameStart extends Component {\n\n  constructor() {\n    super();\n    this.state = {\n      started: false\n    };\n  }\n\n  static getDerivedStateFromProps(props, state) {\n    return {started: props.game && props.game.locked}\n  }\n\n  renderTableData = () => {\n    let game = this.props.game;\n    if (!game) return (<tbody></tbody>);\n    return (\n      <tbody>\n        <tr><th>Kierros</th>{game.players.map((p, i) => (<th key={i}>{p.name}</th>))}</tr>\n        {game.score.rounds.map((rs, j) => (<tr key={j}><td key={j} className=\".roundName\">{game.rounds[j].roundName}</td>\n          {rs.map((s, i) => (<td key={j + \":\" + i}>{s === null ? (game.players[i].isDealer && j === game.round ? \"*\" : \"-\") : s}</td>))}\n        </tr>))}\n        <tr><th>Yhteensä</th>{game.score.total.map((ts, i) => (<td key={i}>{ts}</td>))}</tr>\n      </tbody>\n    );\n  };\n\n  startGame = () => {\n    this.props.onStartGame();\n    this.setState({ started: true })\n  }\n\n  exitGame = () => {\n    if (window.confirm(\"Haluatko varmasti poistua pelistä?\")) {\n      this.props.onExitGame();\n    }\n  }\n\n  abandonGame = () => {\n    if (window.confirm(\"Haluatko varmasti hylätä tämän pelin?\")) {\n      this.props.onAbandonGame();\n    }\n  }\n\n  render() {\n    let game = this.props.game;\n    if (!game) return \"\";\n    return (\n      <div className={\"GameStart \" + (this.state.started ? \"closed\" : \"\")}>\n        <div className=\"GameSheet\">\n          <div>\n            <h3>Uusi peli alkamassa</h3>\n            <div>Pelin osallistumiskoodi {game.code}</div>\n            <div>Odotetaan pelaajia.</div>\n          </div><div>\n            <h3>Pelaajat ({game.players.length})</h3>\n            {game.players.map(p => (<div>{p.nick}</div>))}\n          </div>\n          {game.imOwner ?\n            <div style={{display: 'flex', flexFlow: \"row nowrap\", justifyContent: \"space-around\", minWidth: \"80%\" }}>\n              <button className=\"btn btn-secondary\" onClick={this.abandonGame}>Hylkää peli!</button>\n              <button className=\"btn btn-dark\" onClick={this.startGame}>Kaikki paikalla, aloitetaan</button>\n            </div>\n            :\n            <button className=\"btn btn-dark\" onClick={this.exitGame}>Älä osallistukaan</button>\n          }\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default GameStart;\n","\nimport React, { Component } from \"react\";\n\nclass ScoreBoard extends Component {\n\n  constructor() {\n    super();\n    this.state = {\n      closed: false\n    };\n  }\n\n  renderTableData = () => {\n    let game = this.props.game;\n    console.log(game);\n    if (!game) return (<tbody></tbody>);\n    return (\n      <tbody>\n        <tr><th>Kierros</th>{game.players.map((p, i) => (<th key={i}>{p.name}</th>))}</tr>\n        {game.score.rounds.map((rs, j) => (<tr key={j}><td key={j} className=\".roundName\">{game.rounds[j].roundName}</td>\n          {rs.map((s, i) => (<td key={j + \":\" + i}>{s === null ? (game.players[i].isDealer && j === game.round ? \"*\" : \"-\") : s}</td>))}\n        </tr>))}\n        <tr><th>Yhteensä</th>{game.score.total.map((ts, i) => (<td key={i}>{ts}</td>))}</tr>\n      </tbody>\n    );\n  };\n\n  close = () => {\n    this.props.onScoreBoardClosed();\n    this.setState({ closed: true })\n  }\n\n  render() {\n    return (\n      <div className={\"ScoreBoard \" + (this.state.closed ? \"closed\" : \"\")}>\n        <div className=\"ScoreSheet\">\n          <div className=\"ScoreBoardTable\">\n            <table className=\"table table-striped\">\n              {this.renderTableData()}\n            </table>\n          </div>\n          <button className=\"btn btn-dark\" onClick={this.close}>Peliin</button>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default ScoreBoard;\n","import React, { Component } from \"react\";\n\nclass Hand extends Component {\n\n  constructor(props){\n    super(props)\n  }\n\n  componentDidMount() {\n  }\n\n  componentDidUpdate() {\n    \n  }\n\n  onClick = () => {\n    if (this.props.onClick) this.props.onClick(); // call parent\n  }\n\n  getClasses = () => \"Hand \" + this.props.classes  + (this.props.selected ? \" selected\" : \"\") + (this.props.error ? \" error\" : \"\");\n\n  render() {\n    return (\n      <div id={this.props.id} className={this.getClasses()} style={this.props.style} onClick={this.onClick}>\n      </div>\n    );\n  }\n}\n\nexport default Hand;\n","import $ from 'jquery';\nimport 'jquery-ui-bundle';\nimport 'jquery-ui-bundle/jquery-ui.css';\n\nvar cards = (function() {\n\n\tvar opt = {\n\t\tcardSize : {width:69, height:94, spacing:40}\n\t};\n\n\tfunction mouseEvent(ev) {\n\t\tvar card = $(this).data('card');\n\t\tif (card && card.container) {\n\t\t\tvar handler = card.container[\"_\" + ev.type];\n\t\t\tif (handler) {\n\t\t\t\thandler.func.call(handler.context||window, card, ev);\n\t\t\t}\n\t\t}\n\t}\n\t\n\tfunction Card(suit, rank, back, id, table) {\n\t\tthis.init(suit, rank, back, id, table);\n\t}\n\t\n\tCard.prototype = {\n\t\tinit: function (suit, rank, back, id, table) {\n\t\t\tthis.id = id;\n\t\t\tthis.el = $('<div/>').addClass('playingcard').data('card', this).appendTo($(table));\n\t\t\tthis.el.html(\n\t\t\t\t'<img src=\"\" alt=\"card face up\" class=\"faceup-img\"/>' +\n\t\t\t\t'<img src=\"\" alt=\"card face down\" class=\"facedown-img\"/>'\n\t\t\t);\n\n\t\t\t$(this.el).css(\"opacity\", 0);\n\t\t\tsetTimeout(() => $(this.el).css(\"opacity\", \"\"), 1000);\n\n\t\t\tthis.reveal(suit, rank, back);\n\t\t\tthis.faceUp = false;\n\n\t\t\t$(this.el).click(mouseEvent);\n\n\t\t\t$(this.el).draggable({\n\t\t\t\tstack: \".playingcard\",\n\t\t\t\tcontainment: \".CardTable\",\n\t\t\t\tstart: () => {this.dragging = true; $(this.el).css('z-index', 1000);},\n\t\t\t\tstop: () => {this.dragging = false} \n\t\t\t});\t\n\t\t},\n\n\t\treveal(suit, rank, back) {\n\t\t\tif (this.suit === suit && this.rank === rank && this.back === back) return;\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.suit = suit;\n\t\t\t\tthis.rank = rank;\n\t\t\t\tthis.cardback = back === 1 ? 'red' : 'blue';\n\t\t\t\tthis.name = suit ? suit + rank : \"e\";\n\t\t\t\t$(this.el).find(\".faceup-img\").attr(\"src\", \"svg/\" + this.name + \".svg\");\n\t\t\t\t$(this.el).find(\".facedown-img\").attr(\"src\", \"svg/cardback_\" + this.cardback + \".svg\");\t\n\t\t\t}, this.suit !== undefined && suit === undefined ? 2000 : 0); // delay anonymisign so that the card has been flipped\n\t\t},\n\n\t\tpullUp: function(pixels) {\n\t\t\tvar top = parseInt($(this.el).css('top'));\n\t\t\t$(this.el).css({top: (top-pixels), transition: 'none'});\n\t\t},\n\n\t\tshowCard : function() {\n\t\t\t$(this.el).toggleClass(\"faceup\", true);\n\t\t},\n\n\t\thideCard : function(position) {\n\t\t\t$(this.el).toggleClass(\"faceup\", false);\n\t\t},\n\t\t\n\t\trect : function() {\n\t\t\treturn elementRect(this.el);\n\t\t}\n\t};\n\t\n\tfunction Container() {\t\n\t}\n\t\n\tContainer.prototype = [];\n\tContainer.prototype.extend = function(obj) {\n\t\tfor (var prop in obj) {\n\t\t\tthis[prop] = obj[prop];\n\t\t}\n\t}\n\n\tContainer.prototype.extend({\n\t\taddCard : function(card) {\n\t\t\tthis.addCards([card]);\n\t\t},\t\t\n\t\taddCards : function(cards) {\n\t\t\tfor (var i = 0; i < cards.length;i++) {\n\t\t\t\tvar card = cards[i];\n\t\t\t\tif (card.container && card.container !== this) {\n\t\t\t\t\tcard.container.removeCard(card);\n\t\t\t\t}\n\t\t\t\tif (!card.container || card.container !== this) {\n\t\t\t\t\tthis.push(card);\n\t\t\t\t}\n\t\t\t\tcard.container = this;\n\t\t\t\tcard.el.draggable(this.isDraggable ? \"enable\" : \"disable\");\n\t\t\t}\n\t\t\tif (this.setElementWidth) this.setElementWidth();\n\t\t},\n\t\tremoveCard : function(card) {\n\t\t\tlet index = this.indexOf(card);\n\t\t\tif (index >= 0) {\n\t\t\t\tthis.splice(this.indexOf(card), 1);\n\t\t\t\tcard.container = null;\n\t\t\t\tif (this.setElementWidth) this.setElementWidth();\n\t\t\t}\n\t\t},\n\n\t\tinit : function(options) {\n\t\t\toptions = options || {};\n\t\t\tthis.maxWidth = options.maxWidth || 1000000;\n\t\t\tthis.minWidth = options.minWidth;\n\t\t\tthis.spacing = options.spacing || opt.cardSize.spacing;\n\t\t\tthis.faceUp = options.faceUp;\n\t\t\tthis.element = options.element;\n\t\t\tthis.isDraggable = options.isDraggable;\n\t\t\tthis.pullUp = options.pullUp;\n\n\t\t\tif (this.element) {\n\t\t\t\tthis.element.data('container', this);\n\t\t\t}\n\t\t},\n\n\t\tclick : function(func, context) {\n\t\t\tthis._click = {func:func,context:context};\n\t\t},\n\n\t\tgetNewIndex: function(card) {\n\t\t\tlet newX = card.rect().x;\n\t\t\treturn this.filter(c => c !== card && c.rect().x < newX).length;\n\t\t},\n\n\t\tmoveCardToTarget: function(card) {\n\t\t\tif (card.currTop !== card.targetTop || Math.abs(card.currLeft - card.targetLeft) > 2) {\n\t\t\t\tif (this.pullUp && card.currTop === card.targetTop) {\n\t\t\t\t\tcard.pullUp(15 *  Math.sign(card.currLeft - card.targetLeft));\n\t\t\t\t}\n\t\t\t\tlet distance = Math.max(Math.abs(card.currTop-card.targetTop), Math.abs(card.currLeft-card.targetLeft)); \n\t\t\t\tcard.el.toggleClass(\"fast-move\", (distance < opt.cardSize.height && !this.pullUp));\n\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tvar props = {top:card.targetTop, left:card.targetLeft, transition: \"\"};\n\t\t\t\t\t$(card.el).css(props);\n\t\t\t\t}, 0);\n\t\t\t}\n\t\t},\n\n\t\trender : function(options) {\n\t\t\toptions = options || {};\n\t\t\tvar speed = options.speed;\n\t\t\tthis.calcPosition(options);\n\t\t\tfor (var i=0;i<this.length;i++) {\n\t\t\t\tvar card = this[i];\n\t\t\t\tif (!card.dragging) {\n\t\t\t\t\t$(card.el).css('z-index', i);\n\t\t\t\t\tcard.currTop = parseInt($(card.el).css('top'));\n\t\t\t\t\tcard.currLeft = parseInt($(card.el).css('left'));\n\t\t\t\t\tthis.moveCardToTarget(card);\n\t\t\t\t}\n\t\t\t}\n\t\t\tvar me = this;\n\t\t\tvar flip = function() {\n\t\t\t\tfor (var i=0;i<me.length;i++) {\n\t\t\t\t\tif (me.faceUp) {\n\t\t\t\t\t\tme[i].showCard();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tme[i].hideCard();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (options.immediate) {\n\t\t\t\tflip();\n\t\t\t} else {\n\t\t\t\tsetTimeout(flip, speed *4/5);\n\t\t\t}\n\t\t\t\n\t\t\tif (options.callback) {\n\t\t\t\tsetTimeout(options.callback, speed);\n\t\t\t}\n\t\t},\n\t\t\n\t\ttopCard : function() {\n\t\t\treturn this[this.length-1];\n\t\t}\n\t});\n\t\n\tfunction Deck(options) {\n\t\tthis.init(options);\n\t}\n\t\n\tDeck.prototype = new Container();\n\tDeck.prototype.extend({\n\t\tcalcPosition : function(options) {\n\t\t\tvar boundingRect = this.element ? elementRect(this.element) : { x: this.x, y: this.y, width: 0, height: 0};\n\t\t\tvar centerX = boundingRect.x + boundingRect.width / 2;\n\t\t\tvar centerY = boundingRect.y + boundingRect.height / 2;\n\t\t\tvar left = Math.round(centerX - opt.cardSize.width/2, 0);\n\t\t\tvar top = Math.round(centerY - opt.cardSize.height/2, 0);\n\t\t\tvar condenseCount = 6;\n\t\t\tfor (var i=0;i<this.length;i++) {\n\t\t\t\tif (i > 0 && i % condenseCount === 0) {\n\t\t\t\t\ttop-=1;\n\t\t\t\t\tleft-=1;\n\t\t\t\t}\n\t\t\t\tthis[i].targetTop = top;\n\t\t\t\tthis[i].targetLeft = left;\n\t\t\t}\n\t\t}\n\t});\n\n\tfunction Hand(options) {\n\t\tthis.init(options);\n\t}\n\n\tHand.prototype = new Container();\n\tHand.prototype.extend({\n\t\tsetElementWidth: function() {\n\t\t\tif (!this.minWidth || !this.element) return;\n\t\t\tvar pad = this.spacing;\n\t\t\tvar desiredWidth = opt.cardSize.width + Math.max(this.length - 1, 0) * pad;\n\t\t\tvar width = Math.max(this.minWidth, desiredWidth);\n\t\t\tthis.element.width(width);\n\t\t},\n\t\tcalcSpacing: function(options) {\n\t\t\tvar maxWidth = this.element ? elementRect(this.element).width - 10 : false || this.maxWidth;\n\t\t\tvar spacing = options.spacing ? options.spacing : opt.cardSize.spacing;\n\t\t\tvar desiredWidth = Math.max(this.length - 1, 0) * spacing + opt.cardSize.width;\n\t\t\treturn desiredWidth  <= maxWidth ? spacing : (maxWidth - opt.cardSize.width) / Math.max(this.length - 1, 0);\n\t\t},\n\t\tcalcPosition : function(options) {\n\t\t\toptions = options || {};\n\t\t\tvar spacing = this.calcSpacing(options);\n\t\t\tvar cardWidth = opt.cardSize.width + (this.length-1)*spacing;\n\t\t\tvar boundingRect = this.element ? elementRect(this.element) : { x: this.x, y: this.y, width: 0, height: 0};\n\t\t\tvar centerX = boundingRect.x + boundingRect.width / 2;\n\t\t\tvar centerY = boundingRect.y + boundingRect.height / 2;\n\t\t\tvar left = Math.round(centerX - cardWidth/2);\n\t\t\tvar top = Math.round(centerY - opt.cardSize.height/2, 0);\n\t\t\tfor (var i=0;i<this.length;i++) {\n\t\t\t\tthis[i].targetTop = top;\n\t\t\t\tthis[i].targetLeft = left + i * spacing;\n\t\t\t}\n\t\t},\n\t});\n\t\n\tvar elementRect = function(element) {\n\t\treturn {\n\t\t\tx: parseInt(element.position().left) +\n\t\t\t\tparseInt(element.css(\"border-left-width\")) +\n\t\t\t\tparseInt(element.css(\"margin-left\")),\n\t\t\ty: parseInt(element.position().top) +\n\t\t\t\tparseInt(element.css(\"border-top-width\")) +\n\t\t\t\tparseInt(element.css(\"margin-top\")),\n\t\t\twidth: element.width(),\n\t\t\theight: element.height()\n\t\t};\n\t}\n\n\treturn {\n\t\toptions : opt,\n\t\tCard : Card,\n\t\tContainer : Container,\n\t\tDeck : Deck,\n\t\tHand : Hand,\n\t};\n\t \n})();\n\nexport default cards;","import * as $ from 'jquery';\nimport 'jquery-ui-bundle';\nimport 'jquery-ui-bundle/jquery-ui.css';\nimport cards from './cards.js';\n// import Popper from 'popper.js';\nimport 'bootstrap/dist/js/bootstrap.bundle.min';\n\nfunction centerX(element) {\n  return parseInt(element.position().left) + parseInt(element.css(\"border-left-width\")) + parseInt(element.css(\"margin-left\")) + element.width() / 2;\n}\n\nwindow.jQuery = $;\nrequire('jquery-ui-touch-punch');\n\nvar game = (function() {\n\nvar allCards = [];\n\nvar state = {};\n\nlet deck;\nlet otherPlayers = [];\nlet myClosedHandSections = [];\nlet myOpenHandSections = [];\nlet discardPile;\n\nfunction createNewSection(index) {\n  var el = $(\"#section\" + index);\n\tvar section = new cards.Hand({\n\t\tfaceUp: true,\n\t\telement: el,\n\t\tminWidth: 80,\n\t\tisDraggable: true\n\t});\n\tel.droppable({\n\t\taccept: \".playingcard\",\n\t\tgreedy: true,\n\t\tdrop: function(event, ui) {\n      var card = ui.draggable.data('card');\n      let index = section.getNewIndex(card);\n      newOrder(card, section, index);\n\t\t}\n\t});\n\t// el.popover({\n\t// \tcontainer: '.CardTable',\n\t// \tplacement: 'top',\n\t// \ttrigger: 'manual',\n\t// \tcontent: () => section.validity.msg\n\t// });\n\treturn section;\n}\n\nfunction createNewOpenHand(playerId, handArray, selector) {\n  let element = $(selector);\n  let openhand = new cards.Hand({faceUp:true, spacing: 20, minWidth: 100, element: element});\n  let index = handArray.length;\n  handArray.push(openhand);\n\n  element.droppable({\n\t\taccept: (cardElement) => {\n      let card = cardElement.data('card');\n      return openhand.accepts.filter(acc => acc.r === card.rank && (!acc.s || acc.s === card.suit)).length > 0;    \n    },\n\t\tgreedy: true,\n\t\tdrop: function(event, ui) {\n      var card = ui.draggable.data('card');\n      let firstHalf = centerX(ui.draggable) < centerX(element);\n      let dropIndex = openhand.getNewIndex(card);\n      sendAction('complete', {card: card.id, player: playerId, hand: index, firstHalf: firstHalf, dropIndex: dropIndex});\n\t\t}\n\t});\n}\n\n// ===========\n\nfunction findCard(servercard) {\n\tlet card = allCards.filter(c => c.id === servercard.i)[0];\n\tif (!card) {\n\t\tcard = new cards.Card(servercard.s, servercard.r, servercard.b, servercard.i, \".CardTable\");\n\t\tallCards.push(card);\n\t}\n\tcard.reveal(servercard.s, servercard.r, servercard.b);\n\treturn card;\n}\n\nfunction updateContainer(container, servercards, reverse) {\n\tlet cards = servercards.map(servercard => findCard(servercard));\n  cards.forEach(card => {if (card.container) card.container.removeCard(card); });\n  container.forEach(card => container.removeCard(card));\n  container.addCards(reverse ? cards.reverse() : cards);\n\tsetTimeout(() => container.render(), 0);\n}\n\nfunction populateState() {\n\n  let imGuest = state.myhands === null || state.myhands.open === undefined;\n\n  myClosedHandSections.forEach(section => section.element = null);\n  myClosedHandSections = [];\n  $(\".hand-section\").each(index => myClosedHandSections.push(createNewSection(index)));\n\n  updateContainer(deck, state.deck, true);\n\tupdateContainer(discardPile, state.pile, true);\n\n  state.players.forEach((p, i) => {\n    while (otherPlayers.length - 1 < i) {\n      var closedhand = new cards.Hand({faceUp:false, minWidth: 100, spacing: 25, pullUp: true, element: $(\"#player\" + i + \" .closed-hand\")});\n      otherPlayers.push({closed: closedhand, open: []});\n    }\n    let otherPlayer = otherPlayers[i];\n    updateContainer(otherPlayer.closed, p.closed);\n\n    otherPlayer.open.forEach(hand => hand.element = null);\n    otherPlayer.open = [];\n    p.open.forEach((open, i2) => {\n      while (otherPlayer.open.length - 1 < i2) {\n        createNewOpenHand(p.index, otherPlayer.open, \"#p\" + i + \"o\" + i2);\n      }\n      updateContainer(otherPlayer.open[i2], open.cards);\n      otherPlayer.open[i2].accepts = open.accepts;\n    });\n  });\n\n  if (!imGuest) {\n    state.myhands.closed.forEach((section, i) => {\n      let hand = myClosedHandSections[i];\n      updateContainer(hand, section);\n    });\n  \n    myOpenHandSections.forEach(section => section.element = null);\n    myOpenHandSections = [];\n    let i = 0;\n    while (myOpenHandSections.length < state.myhands.open.length) {\n      createNewOpenHand(state.myhands.index, myOpenHandSections, \"#myopen\" + i);\n      i++;\n    }\n  \n    state.myhands.open.forEach((open, i) => {\n      let hand = myOpenHandSections[i];\n      updateContainer(hand, open.cards);\n      hand.accepts = open.accepts;\n    });\n    \n  }\n\n  $(\"#pile\").droppable({disabled: !state.can.discard});\n  $(\".open-hand\").droppable({disabled: !state.can.complete});\n}\n\nfunction sendAction(action, params) {\n  stateManager.sendAction(action, params);\n}\n\nfunction newSection(firstCardInNewSection) {\n  let newOrder = myClosedHandSections.map(hand => hand.map(card => card.id).filter(id => id !== firstCardInNewSection.id));\n  newOrder = [...newOrder, [firstCardInNewSection.id]].filter(section => section.length > 0);\n\tsendAction('newOrder', {order: newOrder});\n}\n\nfunction newOrder(movedCard, hand, index) {\n  let handIndex = myClosedHandSections.indexOf(hand);\n  let newOrder = myClosedHandSections.map(hand => hand.map(card => card.id).filter(id => id !== movedCard.id));\n  newOrder[handIndex].splice(index,0,movedCard.id);\n  newOrder = newOrder.filter(section => section.length > 0);\n  sendAction('newOrder', {order: newOrder});\n}\n\nfunction stateChange(params) {\n  console.log('game.stateChange', params);\n\tswitch (params.action) {\n\t\tcase 'init': case 'fullState':\n      state = params.state;\n\t\t\tpopulateState();\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n}\n\nvar stateManager;\n\nfunction init(_stateManager) {\n\n  stateManager = _stateManager;\n  \n\t$(window).resize(function(){\n\t\tsetTimeout(populateState, 100);\n\t});\n\n\tdeck = new cards.Deck({\n    faceUp: false,\n    element: $(\"#deck\")\n  }); \n\n  deck.click(() => {\n\t\tif (state.can.pick) {\n      sendAction('pickCard', {fromDeck: true});\n\t\t}\n\t});\n\t\n\tdiscardPile = new cards.Deck({\n    faceUp: true, \n    element: $(\"#pile\")\n\t});\n\n\tdiscardPile.click(() => {\n    if (state.can.buy) {\n      sendAction('requestToBuy');\n    } else if (state.can.sell) {\n      sendAction('dontsell');\n    } else if (state.can.pick) {\n      sendAction('pickCard', {fromDeck: false});\n\t\t}\n\t});\n\n  $(\"#pile\").droppable({\n\t\taccept: \".playingcard\",\n\t\tgreedy: true,\n\t\tdrop: function(event, ui) {\n      var card = ui.draggable.data('card');\n      sendAction('discarded', {card: card.id});\n\t\t}\n\t});\n\t\n\t$(\"#newsection\").droppable({\n\t\taccept: \".playingcard\",\n\t\tgreedy: true,\n\t\tdrop: function(event, ui) {\n      var card = ui.draggable.data('card');\n      newSection(card);\n\t\t}\n\t});\n\t\t\n\t$(\".CardTable\").droppable({\n\t\taccept: \".playingcard\",\n\t\tdrop: function(event, ui) {\n      var card = ui.draggable.data('card');\n      card.dragging = false;\n\t\t\tcard.container.render();\n\t\t}\n\t});\n  \n  $(\".hand-section\").each(index => myClosedHandSections.push(createNewSection(index)));\n}\n\nreturn {\n  init: init,\n  stateChange: stateChange\n};\n\n})();\n\nexport default game;","\nimport React, { Component } from \"react\";\nimport './CardTable.css';\nimport Hand from './Hand.js';\nimport game from './game';\n\nclass CardTable extends Component {\n\n  constructor() {\n    super();\n    this.state = {\n      // s: { can: {}, players: [], myhands: {closed: [], open: []} },\n      selected: [],\n      selectionOk: false,\n      opening: false\n    };\n    this.gameInitialized = false;\n  }\n\n  onStateChange = () => {\n    this.setState({...this.state, s : this.props.stateManager.getState()});\n  }\n\n  componentDidMount() {\n    this.props.stateManager.subscribeTo('stateChange', this.onStateChange);\n  }\n\n  componentWillUnmount() {\n    this.props.stateManager.unsubscribe('stateChange', this.onStateChange);\n  }\n\n  componentDidUpdate() {\n    if (this.state.s && this.state.s.phase > 0 && this.state.s.phase < 6 && this.props.canStart) {\n      if (!this.gameInitialized) {\n        game.init(this.props.stateManager);      \n      }\n      game.stateChange({action: 'fullState', state: {...this.state.s, opening: this.state.opening}});\n    }\n  }\n\n  createPlayers() {\n    let state = this.state.s;\n    return state.players.map((p, index) => {\n      return (\n      <div id={\"player\" + index} key={\"o\" + index} \n        className={\"other-player turn-indicator\" + (p.inTurn ? \" in-turn\" : \"\")}>\n        <div className=\"player-name\">{p.name}</div>\n        <div className=\"player-hands\">\n          <Hand classes=\"player-hand closed-hand\"/>\n          {p.open.map((h, i) => <Hand key={\"p\" + index + \"o\" + i} id={\"p\" + index + \"o\" + i} classes=\"player-hand open-hand\"></Hand>)}\n        </div>\n      </div>\n    );});\n  }\n\n  createMySections() {\n    if (!this.state.s.myhands) return \"\";\n    let sections = this.state.s.myhands.closed;\n    return (\n      <div>\n        {this.state.s.myhands.closed.map((section, i) => \n        <Hand key={i} id={\"section\" + i} \n          classes=\"hand-section section\" \n          error={this.state.opening && i < sections.length && !this.state.s.myhands.validity[i].valid}\n          selected = {this.state.selected && this.state.selected.length > i ? this.state.selected[i] : false}\n          onClick={() => this.onSectionClicked(i)}>\n        </Hand>)}\n      </div>\n    );\n  }\n\n  validateSelection = (sel, callback) => {\n    let state = this.state.s; \n    let selection = sel.reduce((acc, selected, i) => (\n      !selected ? acc :\n      {...acc, \n        sets: acc.sets + (state.myhands.validity[i].type === 'set' ? 1 : 0),\n        straights: acc.straights + (state.myhands.validity[i].type === 'straight' ? 1 : 0),\n        cards: acc.cards + state.myhands.closed[i].length\n      }), {sets: 0, straights: 0, cards: 0});\n    let selectionOk = \n      (!state.round.isFreestyle \n        && selection.sets === state.round.expectedSets\n        && selection.straights === state.round.expectedStraights) ||\n      (state.round.isFreestyle\n        && state.myhands.closed.flat().length - selection.cards <= 1);\n\n    if (selectionOk) {\n      this.props.stateManager.validateSelection(sel.map((x, i) => x ? i : -1).filter(i => i >= 0), result => {\n        callback (result.valid, result.msg);\n      });\n    } else {\n      callback(false);\n    }\n  }\n\n  onSectionClicked = (index) => {\n    let state = this.state.s; \n    if (!state.myhands.validity[index].valid) return;\n    let sel = [...this.state.selected];\n    sel[index] = !sel[index];\n\n    this.validateSelection(sel, (ok, msg) => this.setState({selected: sel, selectionOk: ok, msg: msg}));\n  }\n\n  startOpening() {\n    this.setState({opening: true, selected: this.state.s.myhands.closed.map(() => false), selectionOk: false});\n  }\n\n  cancelOpening() {\n    this.setState({opening: false});\n  }\n\n  confirmOpening() {\n    this.props.stateManager.sendAction('open', {selectedIndices: this.state.selected.map((x, i) => x ? i : -1).filter(i => i >= 0)});\n    this.setState({opening: false, selectionOk: false});\n  }\n\n  createInstructions() {\n    let state = this.state.s;\n    console.log(state);\n    if (state.phase === 1) {\n      if (state.myTurn) {\n        return <div>Sinun vuorosi jakaa.</div>\n      } else {\n        return <div><span>{state.players[state.playerInTurn].name}</span> jakaa kortit</div>\n      }\n    } else if (state.phase === 2) {\n      if (state.myTurn) {\n        return <div>Sinä aloitat. Kun kaikki ovat järjestäneet korttinsa ja ovat valmiita, voit avata yhden kortin pakasta.</div>\n      } else {\n        return <div><span>{state.players[state.playerInTurn].name}</span> aloittaa. Järjestä kortit ja ole valmis, kun peli alkaa.</div>\n      }\n    } else if (state.phase === 3 || state.phase === 3.2) {\n      if (state.myTurn) {\n        return <div>Nosta kortti pakasta tai avopakasta klikkaamalla</div>\n      } else {\n        return <div><span>{state.players[state.playerInTurn].name}</span> nostaa{state.can.buy ? \". Voit yrittää ostaa kortin klikkaamalla avopakkaa.\": \"\"} </div>\n      }\n    } else if (state.phase === 3.1) {\n      if (state.buying < 0) {\n        return <div>Haluat ostaa. {state.players[state.playerInTurn].name} miettii.</div>\n      } else if (state.can.sell) {\n        return <div>{state.players[state.buying].name} haluaa ostaa.</div>\n      } else {\n        return <div>{state.players[state.buying].name} haluaa ostaa. {state.players[state.playerInTurn].name} miettii.</div>\n      }\n    } else if (state.phase === 4) {\n      if (state.myTurn) {\n        if (state.can.open && !this.state.opening) {\n          return <div>Pelaa vuoro ja laita lopuksi kortti avopakkaan</div>\n        } else if (this.state.opening) {\n          return <div>Valitse {this.state.s.round.roundName}</div>\n        } else {\n          return <div>Pelaa vuoro ja laita lopuksi kortti avopakkaan</div>\n        }\n      } else {\n        return <div><span>{state.players[state.playerInTurn].name}</span> pelaa vuoroaan.</div>\n      }\n    } else if (state.phase === 5) {\n      if (state.winner < 0) {\n        return <div className=\"winner\">Sinä voitit tämän kierroksen!</div>\n      } else {\n        return <div className=\"winner\"><span>{state.players[state.winner].name}</span> voitti tämän kierroksen</div>\n      }\n    }\n    return \"\";\n\n  }\n\n  createControls() {\n    let state = this.state.s;\n    if (state.can.deal) {\n      return <button onClick={() => this.props.stateManager.sendAction('deal')}>Jaa kortit</button>\n    } else if (state.can.show) {\n      return <button onClick={() => this.props.stateManager.sendAction('showCard')}>Avaa kortti</button>\n    } else if (state.can.sell) {\n      return (\n        <div> \n          <button onClick={() => this.props.stateManager.sendAction('sell')}>Myyn</button>\n          <button onClick={() => this.props.stateManager.sendAction('dontsell')}>En myy</button>\n        </div>);\n    } else if (state.can.open && !this.state.opening) {\n      return <button onClick={() => this.startOpening()}>Avaan</button>\n    } else if (this.state.opening) {\n      return (<div>\n        <button onClick={() => this.confirmOpening()} disabled={!this.state.selectionOk}>Avaa valitut</button>\n        <button onClick={() => this.cancelOpening()}>En avaakaan</button>\n      </div>);\n    } else if (state.can.startNextRound) {\n      return <button onClick={() => this.props.onNextRound()}>Aloita seuraava kierros</button>\n    } else if (state.can.endGame) {\n      return <button onClick={() => this.props.onEndGame()}>Sulje peli</button>\n    }\n    return \"\";\n  }\n\n  render() {\n\n    console.log(this.state.s);\n\n    if (!this.props.canStart || !this.state.s || this.state.s.phase === 6) return (\n      <div className=\"CardTable\"></div>\n    );\n\n    console.log(this.state.s);\n\n    // if (!this.state.s) return \"Latautuu...\";\n\n    let imGuest = this.state.s.myhands === null || this.state.s.myhands.open === undefined;\n\n    return (\n      <div className={\"CardTable \" + (this.state.opening ? \"selecting\" : \"\") + (this.state.s.myhands && this.state.s.myhands.inTurn ? \" in-turn\" : \"\")}>\n        <div id=\"otherplayers\">\n            {this.createPlayers()}\n        </div>\n        <div id=\"gamearea\" className={\"turn-indicator \" + (this.state.s.myhands && this.state.s.myhands.inTurn ? \"in-turn\" : \"\")}>\n          <div id=\"roundinfo\">Kierros {this.state.s.round.roundNumber}/8 &ndash; {this.state.s.round.roundName}</div>\n          <div id=\"instructions\">\n                {this.createInstructions()}\n          </div>\n          <div id=\"deckrow\">\n            <div id=\"deckandpile\">\n              <div id=\"deck\"></div>\n              <div id=\"pile\"></div>\n            </div>\n            {imGuest ? \"\" : (\n            <div id=\"deckrowcolumn2\">\n              {this.state.s.myhands.open.map((h, i) => <Hand key={\"m\" + i} id={\"myopen\" + i} classes=\"player-hand open-hand\"></Hand>)}\n              <div id=\"controls\">\n                {this.createControls()}\n              </div>\n            </div>)}\n          </div>\n          {imGuest ? \"\" : (\n          <div id=\"my-closed-hand-sections\" className={\"turn-indicator \" + (this.state.s.myhands && this.state.s.myhands.inTurn ? \"in-turn\" : \"\")}>\n            <div id=\"section-template\" className=\"section\" style={{display: 'none'}}></div>\n            {this.createMySections()}\n            <div id=\"newsection\" className=\"new-section\" style={{visibility: (this.state.s.phase >= 2 && this.state.s.phase <= 4) ? \"visible\" : \"hidden\"}}><div>+</div></div>\n          </div>)}\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default CardTable;\n","\nimport React, { Component } from \"react\";\nimport './GameRoom.css';\nimport GameStart from './GameStart.js';\nimport ScoreBoard from './ScoreBoard.js';\nimport CardTable from './CardTable.js';\n\nclass GameRoom extends Component {\n\n  constructor() {\n    super();\n    this.state = {\n      canStart: false,\n    };\n  }\n\n  onStateChange = () => {\n    let roundState = this.props.stateManager.getState();\n    this.setState({game: roundState.game});\n  }\n\n  componentDidMount() {\n    this.props.stateManager.subscribeTo('stateChange', this.onStateChange);\n  }\n\n  componentWillUnmount() {\n    this.props.stateManager.unsubscribe('stateChange', this.onStateChange);\n  }\n\n  componentDidUpdate() {\n  }\n\n  onScoreBoardClosed = () => {\n    this.setState({canStart: true});\n  }\n\n  onStartGame = () => {\n    this.setState({canStart: true});\n    this.props.stateManager.sendGameAction('startGame');\n  }\n\n  onNextRound = () => {\n    this.props.stateManager.sendGameAction('nextRound');\n  }\n\n  onEndGame = () => {\n    this.props.stateManager.sendGameAction('endGame');\n  }\n\n  render() {\n    return (\n        <div className=\"GameRoom\">\n          <GameStart game={this.state.game} onStartGame={this.onStartGame} onAbandonGame={this.props.abandonGame} onExitGame={this.props.exitGame}></GameStart>\n          {/* <ScoreBoard game={this.state.game} onScoreBoardClosed={this.onScoreBoardClosed}></ScoreBoard> */}\n          <CardTable goToGame={this.props.goToGame} onNextRound={this.onNextRound} onEndGame={this.onEndGame} canStart={this.state.game && this.state.game.locked} stateManager={this.props.stateManager}></CardTable>\n        </div>        \n    );\n  }\n}\n\nexport default GameRoom;\n","import socketIOClient from \"socket.io-client\";\n\nclass StateManager {\n\n  constructor() {\n    this.endpoint = window.location.hostname === 'localhost' ? \"http://localhost:4000\" : \"\";\n  }\n\n  async initLobby(lobbyName, callback) {\n    console.log('initLobby', lobbyName);\n\n    if (this.lobby) {\n      this.lobby.close();\n      this.lobby = null;\n    }\n\n    this.lobby = await socketIOClient(this.endpoint + \"/lobby\");\n\n    this.lobby.on('connect', () => {\n      console.log('connected to lobby');\n      callback({connected: true, msg: \"Yhteys ok\"});\n    });\n\n    this.lobby.on('reconnect', () => {\n      console.log('reconnected to lobby');\n    });\n\n    this.lobby.on('reconnect_attempt', (i) => {\n      console.log('attempting to reconnect to lobby', i);\n    });\n\n    this.lobby.on('disconnect', () => {\n      console.log('disconnected from lobby');\n    });\n  }\n\n  findGame(code, callback) {\n    this.lobby.emit('findGame', {code: code}, (result) => {\n      console.log('findGame result', result);\n      callback(result);\n    });\n  }\n\n  createGame(nick, callback) {\n    this.lobby.emit('createGame', {nick: nick}, (result) => {\n      console.log('createGame result', result);\n      callback(result);\n    });\n  }\n\n  joinGame(game, nick, callback) {\n    this.lobby.emit('joinGame', {game: game, nick: nick}, (result) => {\n      console.log('joinGame result', result);\n      callback(result);\n    });\n  }\n\n  resumeParticipation(participation, callback) {\n    this.lobby.emit('resumeParticipation', {participation: participation}, (result) => {\n      console.log('resumeParticipation result', result);\n      callback(result);\n    });\n  }\n\n\n  initGame(gameToken, credentials, callback) {\n    console.log('initGame', gameToken, credentials);\n\n    this.game = socketIOClient(this.endpoint + \"/game/\" + gameToken);\n\n    this.game.on('stateChange', args => {\n      this.stateChange(args);\n    });\n\n    this.game.on('connect', () => {\n      console.log('connected');\n      this.authenticate(credentials, callback);\n    });\n\n    this.game.on('reconnect', () => {\n      console.log('reconnected');\n    });\n\n    this.game.on('reconnect_attempt', (i) => {\n      console.log('attempting to reconnect', i);\n    });\n\n    this.game.on('disconnect', () => {\n      console.log('disconnected');\n    });\n\n    this.game.on('authenticated', () => {\n      this.requestFullState();\n      callback({connected: true, authenticated: true, msg: \"Yhteys ok\"});\n    });\n  }\n\n  closeGame() {\n    if (this.game) {\n      this.game.close();\n      this.game = null;\n    }\n  }\n\n  authenticate(credentials, callback) {\n    this.game.emit('authenticate', credentials, status => callback(status));\n  }\n\n  requestFullState() {\n    this.game.emit('state');\n  }\n\n  getState() {\n    return this.state;\n  }\n\n  stateChange(params) {\n    console.log('StateManager.stateChange', params);\n    switch(params.action) {\n      case 'fullState': \n        this.state = params.state;\n        let event = new CustomEvent('stateChange', { detail: {action: 'fullState', state: params.state}});\n        document.dispatchEvent(event);\n        break;\n    }\n  }\n\n  validateSelection(indices, callback) {\n    console.log('validateSelection', indices);\n    this.game.emit('validateSelection', {selectedIndices: indices}, callback);\n  }\n  \n  sendAction(action, params) {\n    console.log('sendAction', action, params);\n    params = params || {};\n    this.game.emit('action', {...params, action: action});\n  }\n\n  exitGame() {\n    this.game.emit('exitGame');\n  }\n  \n  abandonGame() {\n    this.game.emit('abandonGame');\n  }\n  \n  sendGameAction(action, params) {\n    console.log('sendGameAction', action, params);\n    params = params || {};\n    this.game.emit('gameAction', {...params, action: action});\n  }\n\n  subscribeTo(eventType, callback) {\n    document.addEventListener(eventType, callback);\n  }\n\n  unsubscribe(eventType, callback) {\n    document.removeEventListener(eventType, callback);\n  }\n}\n\nexport default StateManager;\n","import './App.css';\nimport 'bootstrap/dist/css/bootstrap.min.css';\nimport React, { Component } from \"react\";\nimport Lobby from './Lobby.js';\nimport GameRoom from './GameRoom.js';\nimport StateManager from './StateManager.js';\n\nclass App extends Component {\n\n  constructor() {\n    super();\n    this.stateManager = new StateManager();\n    this.state = { inLobby: true, inGame: false, myName: null };\n  }\n\n  componentDidMount() {\n    let search = window.location.search;\n    let code = search ? decodeURIComponent(search.substring(1)) : \"guest\";\n\n    this.stateManager.initLobby(\"lobby\", (x) => {\n      this.setState({ lobbyReady: true });\n      console.log('In the lobby', x);\n    });\n  }\n\n  goToGame = (gameToken, participation) => {\n    console.log('goToGame', gameToken, participation);\n    this.stateManager.initGame(gameToken, {participation: participation }, (result) => {\n      this.setState({ inLobby: false, inGame: true, myName: result.myName, authenticated: true });\n      console.log('App.callback', result);\n    });\n  }\n\n  exitGame = () => {\n    console.log('exitGame');\n    this.setState({ inLobby: true, inGame: false });\n    this.stateManager.exitGame();\n    Lobby.resetState();\n    this.stateManager.closeGame();\n  }\n  \n  abandonGame = () => {\n    console.log('abandonGame');\n    this.setState({ inLobby: true, inGame: false });\n    this.stateManager.abandonGame();\n    Lobby.resetState();\n    this.stateManager.closeGame();\n  }\n  \n  render() {\n    document.title = \"Islanti\";\n    return (\n      <div className=\"App\">\n        {this.state.inLobby ? <Lobby stateManager={this.stateManager} goToGame={this.goToGame} lobbyReady={this.state.lobbyReady}></Lobby> : \"\"}\n        {this.state.inGame ? <GameRoom stateManager={this.stateManager} abandonGame={this.abandonGame} exitGame={this.exitGame}></GameRoom> : \"\"}\n      </div>\n    );\n  }\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}