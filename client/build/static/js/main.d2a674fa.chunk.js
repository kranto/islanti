(this.webpackJsonpislanti=this.webpackJsonpislanti||[]).push([[0],{43:function(e,t,a){e.exports=a(88)},48:function(e,t,a){},49:function(e,t,a){},51:function(e,t,a){},52:function(e,t,a){},85:function(e,t){},88:function(e,t,a){"use strict";a.r(t);var n=a(0),i=a.n(n),s=a(40),o=a.n(s),r=(a(48),a(2)),c=a(3),l=a(4),d=a(5),u=(a(49),a(50),a(6)),m=a(42),h=function(){var e=window.localStorage.getItem("IslantiState")||"{}";return JSON.parse(e)},p=function(e){window.localStorage.setItem("IslantiState",JSON.stringify(e))},g=function(e){Object(d.a)(a,e);var t=Object(l.a)(a);function a(){var e;Object(r.a)(this,a),(e=t.call(this)).onCodeChanged=function(t){e.setState({code:t.target.value,errorMsg:""})},e.onCodeReady=function(){e.setState({loading:!0}),e.props.stateManager.findGame(e.state.code,(function(t){t.ok?e.setState({loading:!1,phase:2,game:t.game,gameCreatedBy:t.createdBy,gameCreatedAt:t.createdAt}):e.setState({loading:!1,code:"",phase:1,errorMsg:t.msg})}))},e.onNewGameClicked=function(){e.setState({newGame:!0,phase:2})},e.onNickChanged=function(t){e.setState({nick:t.target.value})},e.onNickReady=function(){e.setState({loading:!0}),e.saveState(),e.state.newGame?e.createGame():e.joinGame()},e.createGame=function(){e.props.stateManager.createGame(e.state.nick,(function(t){t.ok?e.setState({loading:!1,participation:t.participation.token,nick:t.participation.nick,game:t.game,phase:3,joinedGame:!0}):e.setState({loading:!1,errorMsg:t.msg,code:"",participation:void 0,game:void 0,phase:1,joinedGame:!1}),e.saveState()}))},e.joinGame=function(){e.props.stateManager.joinGame(e.state.game,e.state.nick,(function(t){t.ok?e.setState({loading:!1,participation:t.participation.token,nick:t.participation.nick,game:t.game,phase:3,joinedGame:!0}):e.setState({loading:!1,errorMsg:t.msg,code:"",participation:void 0,game:void 0,phase:1,joinedGame:!1}),e.saveState()}))},e.resumeParticipation=function(){e.validating||(e.validating=!0,e.setState({loading:!0}),e.props.stateManager.resumeParticipation(e.state.participation,(function(t){t.ok?e.setState({loading:!1,participation:t.participation.token,game:t.game,nick:t.participation.nick,phase:3,joinedGame:!0}):e.setState({loading:!1,code:"",participation:void 0,game:void 0,phase:1,joinedGame:!1}),e.saveState(),e.validating=!1})))};var n="",i=window.location.search.substring(1);i.length>0&&i.split("&").map((function(e){var t=e.split("="),a=Object(m.a)(t,2),i=a[0],s=a[1];"pid"===i&&(n=s)}));var s=h()||{},o=n||s.participation;return e.state={game:null,participation:o,phase:o?3:1,joinedGame:!1,code:"",errorMsg:"",newGame:!1,loading:!1,nickEntered:!1,nick:s.nick||""},console.log("entered lobby"),e}return Object(c.a)(a,[{key:"componentDidUpdate",value:function(){this.state&&(3===this.state.phase&&this.props.lobbyReady&&!this.state.joinedGame?(this.resumeParticipation(),this.setState({phase:1})):this.state.joinedGame&&this.props.goToGame(this.state.game,this.state.participation))}},{key:"saveState",value:function(){var e={nick:this.state.nick,game:this.state.game,participation:this.state.participation};p(e)}},{key:"render",value:function(){return this.state?i.a.createElement("div",{className:"Lobby"},1!==this.state.phase?"":i.a.createElement("div",{style:{height:"100%",display:"flex",flexFlow:"column nowrap",justifyContent:"space-around",alignItems:"center"}},i.a.createElement("div",null),i.a.createElement("div",{id:"enterCodeView"},i.a.createElement("h1",null,"Liity peliin"),i.a.createElement("div",{className:"form-group"},i.a.createElement("label",{htmlFor:"inputGameCode"},"Osallistumiskoodi"),i.a.createElement("input",{autoFocus:!0,type:"text",className:"form-control",id:"inputGameCode",maxLength:"4",minLength:"4",value:this.state.code,onChange:this.onCodeChanged,disabled:this.state.loading}),i.a.createElement("small",{id:"gameHelp",className:"form-text text-muted text-gray"},"Sy\xf6t\xe4 saamasi nelinumeroinen osallistumiskoodi"),i.a.createElement("div",{style:{visibility:4===this.state.code.length?"visible":"hidden"}},i.a.createElement("button",{type:"button",className:"btn btn-dark",onClick:this.onCodeReady,disabled:this.state.loading},"Osallistu..."),i.a.createElement("br",null),i.a.createElement("div",{className:"spinner-border spinner-border-sm",role:"status",style:{visibility:this.state.loading?"visible":"hidden"}},i.a.createElement("span",{className:"sr-only"},"Ladataan...")))),i.a.createElement("div",null,this.state.errorMsg,i.a.createElement("span",null,"\xa0"))),i.a.createElement("div",{id:"newGame",style:{visibility:0===this.state.code.length?"visible":"hidden"}},i.a.createElement("button",{type:"button",className:"btn btn-dark",onClick:this.onNewGameClicked,disabled:this.state.code.length>0},"Tai aloita uusi peli..."))),2!==this.state.phase?"":i.a.createElement("div",null,this.state.newGame?i.a.createElement("h1",null,"Uusi peli"):i.a.createElement("div",null,i.a.createElement("h1",null,"Liity peliin ",i.a.createElement("small",null,this.state.code)),i.a.createElement("small",{className:"text-muted text-gray"},"Pelin aloitti ",this.state.gameCreatedBy)),i.a.createElement("div",{className:"form-group"},i.a.createElement("label",{htmlFor:"inputNick"},"Anna nimimerkkisi"),i.a.createElement("input",{autoFocus:!0,type:"text",className:"form-control",id:"inputNick",minLength:"1",maxLength:"20",value:this.state.nick,onChange:this.onNickChanged}),i.a.createElement("small",{id:"nickHelp",className:"form-text text-muted text-gray"},"Voit k\xe4ytt\xe4\xe4 eri nimimerkkej\xe4 eri peleiss\xe4"),i.a.createElement("button",{type:"button",className:"btn btn-dark",onClick:this.onNickReady,style:{visibility:this.state.nick.length>0?"visible":"hidden"}},this.state.newGame?"Aloita uusi peli":"Liity peliin"),i.a.createElement("div",{className:"spinner-border spinner-border-sm",role:"status",style:{visibility:this.state.loading?"visible":"hidden"}},i.a.createElement("span",{className:"sr-only"},"Ladataan..."))))):""}}],[{key:"resetState",value:function(){var e=h();e=Object(u.a)({},e,{game:void 0,participation:void 0}),p(e)}}]),a}(n.Component),f=(a(51),function(e){Object(d.a)(a,e);var t=Object(l.a)(a);function a(){var e;return Object(r.a)(this,a),(e=t.call(this)).renderTableData=function(){var t=e.props.game;return t?i.a.createElement("tbody",null,i.a.createElement("tr",null,i.a.createElement("th",null,"Kierros"),t.players.map((function(e,t){return i.a.createElement("th",{key:t},e.name)}))),t.score.rounds.map((function(e,a){return i.a.createElement("tr",{key:a},i.a.createElement("td",{key:a,className:".roundName"},t.rounds[a].roundName),e.map((function(e,n){return i.a.createElement("td",{key:a+":"+n},null===e?t.players[n].isDealer&&a===t.round?"*":"-":e)})))})),i.a.createElement("tr",null,i.a.createElement("th",null,"Yhteens\xe4"),t.score.total.map((function(e,t){return i.a.createElement("td",{key:t},e)})))):i.a.createElement("tbody",null)},e.startGame=function(){e.props.onStartGame(),e.setState({started:!0})},e.exitGame=function(){window.confirm("Haluatko varmasti poistua pelist\xe4?")&&e.props.onExitGame()},e.abandonGame=function(){window.confirm("Haluatko varmasti hyl\xe4t\xe4 t\xe4m\xe4n pelin?")&&e.props.onAbandonGame()},e.state={started:!1},e}return Object(c.a)(a,[{key:"render",value:function(){var e=this.props.game;return e?i.a.createElement("div",{className:"GameStart "+(this.state.started?"closed":"")},i.a.createElement("div",{className:"GameSheet"},i.a.createElement("div",null,i.a.createElement("h3",null,"Uusi peli alkamassa"),i.a.createElement("div",null,"Pelin osallistumiskoodi ",e.code),i.a.createElement("div",null,"Odotetaan pelaajia.")),i.a.createElement("div",null,i.a.createElement("h3",null,"Pelaajat (",e.players.length,")"),e.players.map((function(e){return i.a.createElement("div",null,e.nick)}))),e.imOwner?i.a.createElement("div",{style:{display:"flex",flexFlow:"row nowrap",justifyContent:"space-around",minWidth:"80%"}},i.a.createElement("button",{className:"btn btn-secondary",onClick:this.abandonGame},"Hylk\xe4\xe4 peli!"),i.a.createElement("button",{className:"btn btn-dark",onClick:this.startGame},"Kaikki paikalla, aloitetaan")):i.a.createElement("button",{className:"btn btn-dark",onClick:this.exitGame},"\xc4l\xe4 osallistukaan"))):""}}],[{key:"getDerivedStateFromProps",value:function(e,t){return{started:e.game&&e.game.locked}}}]),a}(n.Component)),v=(n.Component,a(13)),y=(a(52),function(e){Object(d.a)(a,e);var t=Object(l.a)(a);function a(e){var n;return Object(r.a)(this,a),(n=t.call(this,e)).onClick=function(){n.props.onClick&&n.props.onClick()},n.getClasses=function(){return"Hand "+n.props.classes+(n.props.selected?" selected":"")+(n.props.error?" error":"")},n}return Object(c.a)(a,[{key:"componentDidMount",value:function(){}},{key:"componentDidUpdate",value:function(){}},{key:"render",value:function(){return i.a.createElement("div",{id:this.props.id,className:this.getClasses(),style:this.props.style,onClick:this.onClick})}}]),a}(n.Component)),b=a(1),k=a.n(b),E=(a(23),a(24),function(){var e={cardSize:{width:69,height:94,spacing:40}};function t(e){var t=k()(this).data("card");if(t&&t.container){var a=t.container["_"+e.type];a&&a.func.call(a.context||window,t,e)}}function a(e,t,a,n,i){this.init(e,t,a,n,i)}function n(){}function i(e){this.init(e)}function s(e){this.init(e)}a.prototype={init:function(e,a,n,i,s){var o=this;this.id=i,this.el=k()("<div/>").addClass("playingcard").data("card",this).appendTo(k()(s)),this.el.html('<img src="" alt="card face up" class="faceup-img"/><img src="" alt="card face down" class="facedown-img"/>'),k()(this.el).css("opacity",0),setTimeout((function(){return k()(o.el).css("opacity","")}),1e3),this.reveal(e,a,n),this.faceUp=!1,k()(this.el).click(t),k()(this.el).draggable({stack:".playingcard",containment:".CardTable",start:function(){o.dragging=!0,k()(o.el).css("z-index",1e3)},stop:function(){o.dragging=!1}})},reveal:function(e,t,a){var n=this;this.suit===e&&this.rank===t&&this.back===a||setTimeout((function(){n.suit=e,n.rank=t,n.cardback=1===a?"red":"blue",n.name=e?e+t:"e",k()(n.el).find(".faceup-img").attr("src","svg/"+n.name+".svg"),k()(n.el).find(".facedown-img").attr("src","svg/cardback_"+n.cardback+".svg")}),void 0!==this.suit&&void 0===e?2e3:0)},pullUp:function(e){var t=parseInt(k()(this.el).css("top"));k()(this.el).css({top:t-e,transition:"none"})},showCard:function(){k()(this.el).toggleClass("faceup",!0)},hideCard:function(e){k()(this.el).toggleClass("faceup",!1)},rect:function(){return o(this.el)}},n.prototype=[],n.prototype.extend=function(e){for(var t in e)this[t]=e[t]},n.prototype.extend({addCard:function(e){this.addCards([e])},addCards:function(e){for(var t=0;t<e.length;t++){var a=e[t];a.container&&a.container!==this&&a.container.removeCard(a),a.container&&a.container===this||this.push(a),a.container=this,a.el.draggable(this.isDraggable?"enable":"disable")}this.setElementWidth&&this.setElementWidth()},removeCard:function(e){this.indexOf(e)>=0&&(this.splice(this.indexOf(e),1),e.container=null,this.setElementWidth&&this.setElementWidth())},init:function(t){t=t||{},this.maxWidth=t.maxWidth||1e6,this.minWidth=t.minWidth,this.spacing=t.spacing||e.cardSize.spacing,this.faceUp=t.faceUp,this.element=t.element,this.isDraggable=t.isDraggable,this.pullUp=t.pullUp,this.element&&this.element.data("container",this)},click:function(e,t){this._click={func:e,context:t}},getNewIndex:function(e){var t=e.rect().x;return this.filter((function(a){return a!==e&&a.rect().x<t})).length},moveCardToTarget:function(t){if(t.currTop!==t.targetTop||Math.abs(t.currLeft-t.targetLeft)>2){this.pullUp&&t.currTop===t.targetTop&&t.pullUp(15*Math.sign(t.currLeft-t.targetLeft));var a=Math.max(Math.abs(t.currTop-t.targetTop),Math.abs(t.currLeft-t.targetLeft));t.el.toggleClass("fast-move",a<e.cardSize.height&&!this.pullUp),setTimeout((function(){var e={top:t.targetTop,left:t.targetLeft,transition:""};k()(t.el).css(e)}),0)}},render:function(e){var t=(e=e||{}).speed;this.calcPosition(e);for(var a=0;a<this.length;a++){var n=this[a];n.dragging||(k()(n.el).css("z-index",a),n.currTop=parseInt(k()(n.el).css("top")),n.currLeft=parseInt(k()(n.el).css("left")),this.moveCardToTarget(n))}var i=this,s=function(){for(var e=0;e<i.length;e++)i.faceUp?i[e].showCard():i[e].hideCard()};e.immediate?s():setTimeout(s,4*t/5),e.callback&&setTimeout(e.callback,t)},topCard:function(){return this[this.length-1]}}),i.prototype=new n,i.prototype.extend({calcPosition:function(t){for(var a=this.element?o(this.element):{x:this.x,y:this.y,width:0,height:0},n=a.x+a.width/2,i=a.y+a.height/2,s=Math.round(n-e.cardSize.width/2,0),r=Math.round(i-e.cardSize.height/2,0),c=0;c<this.length;c++)c>0&&c%6===0&&(r-=1,s-=1),this[c].targetTop=r,this[c].targetLeft=s}}),s.prototype=new n,s.prototype.extend({setElementWidth:function(){if(this.minWidth&&this.element){var t=this.spacing,a=e.cardSize.width+Math.max(this.length-1,0)*t,n=Math.max(this.minWidth,a);this.element.width(n)}},calcSpacing:function(t){var a=this.element?o(this.element).width-10:this.maxWidth,n=t.spacing?t.spacing:e.cardSize.spacing;return Math.max(this.length-1,0)*n+e.cardSize.width<=a?n:(a-e.cardSize.width)/Math.max(this.length-1,0)},calcPosition:function(t){t=t||{};for(var a=this.calcSpacing(t),n=e.cardSize.width+(this.length-1)*a,i=this.element?o(this.element):{x:this.x,y:this.y,width:0,height:0},s=i.x+i.width/2,r=i.y+i.height/2,c=Math.round(s-n/2),l=Math.round(r-e.cardSize.height/2,0),d=0;d<this.length;d++)this[d].targetTop=l,this[d].targetLeft=c+d*a}});var o=function(e){return{x:parseInt(e.position().left)+parseInt(e.css("border-left-width"))+parseInt(e.css("margin-left")),y:parseInt(e.position().top)+parseInt(e.css("border-top-width"))+parseInt(e.css("margin-top")),width:e.width(),height:e.height()}};return{options:e,Card:a,Container:n,Deck:i,Hand:s}}());a(53);function C(e){return parseInt(e.position().left)+parseInt(e.css("border-left-width"))+parseInt(e.css("margin-left"))+e.width()/2}window.jQuery=b,a(54);var S=function(){var e,t,a,n=[],i={},s=[],o=[],r=[];function c(e){var t=b("#section"+e),a=new E.Hand({faceUp:!0,element:t,minWidth:80,isDraggable:!0});return t.droppable({accept:".playingcard",greedy:!0,drop:function(e,t){var n=t.draggable.data("card"),i=a.getNewIndex(n);!function(e,t,a){var n=o.indexOf(t),i=o.map((function(t){return t.map((function(e){return e.id})).filter((function(t){return t!==e.id}))}));i[n].splice(a,0,e.id),m("newOrder",{order:i=i.filter((function(e){return e.length>0}))})}(n,a,i)}}),a}function l(e,t,a){var n=b(a),i=new E.Hand({faceUp:!0,spacing:20,minWidth:100,element:n}),s=t.length;t.push(i),n.droppable({accept:function(e){var t=e.data("card");return i.accepts.filter((function(e){return e.r===t.rank&&(!e.s||e.s===t.suit)})).length>0},greedy:!0,drop:function(t,a){var o=a.draggable.data("card"),r=C(a.draggable)<C(n),c=i.getNewIndex(o);m("complete",{card:o.id,player:e,hand:s,firstHalf:r,dropIndex:c})}})}function d(e,t,a){var i=t.map((function(e){return function(e){var t=n.filter((function(t){return t.id===e.i}))[0];return t||(t=new E.Card(e.s,e.r,e.b,e.i,".CardTable"),n.push(t)),t.reveal(e.s,e.r,e.b),t}(e)}));i.forEach((function(e){e.container&&e.container.removeCard(e)})),e.forEach((function(t){return e.removeCard(t)})),e.addCards(a?i.reverse():i),setTimeout((function(){return e.render()}),0)}function u(){var a=null===i.myhands||void 0===i.myhands.open;if(o.forEach((function(e){return e.element=null})),o=[],b(".hand-section").each((function(e){return o.push(c(e))})),d(e,i.deck,!0),d(t,i.pile,!0),i.players.forEach((function(e,t){for(;s.length-1<t;){var a=new E.Hand({faceUp:!1,minWidth:100,spacing:25,pullUp:!0,element:b("#player"+t+" .closed-hand")});s.push({closed:a,open:[]})}var n=s[t];d(n.closed,e.closed),n.open.forEach((function(e){return e.element=null})),n.open=[],e.open.forEach((function(a,i){for(;n.open.length-1<i;)l(e.index,n.open,"#p"+t+"o"+i);d(n.open[i],a.cards),n.open[i].accepts=a.accepts}))})),!a){i.myhands.closed.forEach((function(e,t){d(o[t],e)})),r.forEach((function(e){return e.element=null})),r=[];for(var n=0;r.length<i.myhands.open.length;)l(i.myhands.index,r,"#myopen"+n),n++;i.myhands.open.forEach((function(e,t){var a=r[t];d(a,e.cards),a.accepts=e.accepts}))}b("#pile").droppable({disabled:!i.can.discard}),b(".open-hand").droppable({disabled:!i.can.complete})}function m(e,t){a.sendAction(e,t)}return{init:function(n){a=n,b(window).resize((function(){setTimeout(u,100)})),(e=new E.Deck({faceUp:!1,element:b("#deck")})).click((function(){i.can.pick&&m("pickCard",{fromDeck:!0})})),(t=new E.Deck({faceUp:!0,element:b("#pile")})).click((function(){i.can.buy?m("requestToBuy"):i.can.sell?m("dontsell"):i.can.pick&&m("pickCard",{fromDeck:!1})})),b("#pile").droppable({accept:".playingcard",greedy:!0,drop:function(e,t){m("discarded",{card:t.draggable.data("card").id})}}),b("#newsection").droppable({accept:".playingcard",greedy:!0,drop:function(e,t){!function(e){var t=o.map((function(t){return t.map((function(e){return e.id})).filter((function(t){return t!==e.id}))}));m("newOrder",{order:t=[].concat(Object(v.a)(t),[[e.id]]).filter((function(e){return e.length>0}))})}(t.draggable.data("card"))}}),b(".CardTable").droppable({accept:".playingcard",drop:function(e,t){var a=t.draggable.data("card");a.dragging=!1,a.container.render()}}),b(".hand-section").each((function(e){return o.push(c(e))}))},stateChange:function(e){switch(console.log("game.stateChange",e),e.action){case"init":case"fullState":i=e.state,u()}}}}(),G=function(e){Object(d.a)(a,e);var t=Object(l.a)(a);function a(){var e;return Object(r.a)(this,a),(e=t.call(this)).onStateChange=function(){e.setState(Object(u.a)({},e.state,{s:e.props.stateManager.getState()}))},e.validateSelection=function(t,a){var n=e.state.s,i=t.reduce((function(e,t,a){return t?Object(u.a)({},e,{sets:e.sets+("set"===n.myhands.validity[a].type?1:0),straights:e.straights+("straight"===n.myhands.validity[a].type?1:0),cards:e.cards+n.myhands.closed[a].length}):e}),{sets:0,straights:0,cards:0});!n.round.isFreestyle&&i.sets===n.round.expectedSets&&i.straights===n.round.expectedStraights||n.round.isFreestyle&&n.myhands.closed.flat().length-i.cards<=1?e.props.stateManager.validateSelection(t.map((function(e,t){return e?t:-1})).filter((function(e){return e>=0})),(function(e){a(e.valid,e.msg)})):a(!1)},e.onSectionClicked=function(t){if(e.state.s.myhands.validity[t].valid){var a=Object(v.a)(e.state.selected);a[t]=!a[t],e.validateSelection(a,(function(t,n){return e.setState({selected:a,selectionOk:t,msg:n})}))}},e.state={selected:[],selectionOk:!1,opening:!1},e.gameInitialized=!1,e}return Object(c.a)(a,[{key:"componentDidMount",value:function(){this.props.stateManager.subscribeTo("stateChange",this.onStateChange)}},{key:"componentWillUnmount",value:function(){this.props.stateManager.unsubscribe("stateChange",this.onStateChange)}},{key:"componentDidUpdate",value:function(){this.state.s&&this.state.s.phase>0&&this.state.s.phase<6&&this.props.canStart&&(this.gameInitialized||S.init(this.props.stateManager),S.stateChange({action:"fullState",state:Object(u.a)({},this.state.s,{opening:this.state.opening})}))}},{key:"createPlayers",value:function(){return this.state.s.players.map((function(e,t){return i.a.createElement("div",{id:"player"+t,key:"o"+t,className:"other-player turn-indicator"+(e.inTurn?" in-turn":"")},i.a.createElement("div",{className:"player-name"},e.name),i.a.createElement("div",{className:"player-hands"},i.a.createElement(y,{classes:"player-hand closed-hand"}),e.open.map((function(e,a){return i.a.createElement(y,{key:"p"+t+"o"+a,id:"p"+t+"o"+a,classes:"player-hand open-hand"})}))))}))}},{key:"createMySections",value:function(){var e=this;if(!this.state.s.myhands)return"";var t=this.state.s.myhands.closed;return i.a.createElement("div",null,this.state.s.myhands.closed.map((function(a,n){return i.a.createElement(y,{key:n,id:"section"+n,classes:"hand-section section",error:e.state.opening&&n<t.length&&!e.state.s.myhands.validity[n].valid,selected:!!(e.state.selected&&e.state.selected.length>n)&&e.state.selected[n],onClick:function(){return e.onSectionClicked(n)}})})))}},{key:"startOpening",value:function(){this.setState({opening:!0,selected:this.state.s.myhands.closed.map((function(){return!1})),selectionOk:!1})}},{key:"cancelOpening",value:function(){this.setState({opening:!1})}},{key:"confirmOpening",value:function(){this.props.stateManager.sendAction("open",{selectedIndices:this.state.selected.map((function(e,t){return e?t:-1})).filter((function(e){return e>=0}))}),this.setState({opening:!1,selectionOk:!1})}},{key:"createInstructions",value:function(){var e=this.state.s;return console.log(e),1===e.phase?e.myTurn?i.a.createElement("div",null,"Sinun vuorosi jakaa."):i.a.createElement("div",null,i.a.createElement("span",null,e.players[e.playerInTurn].name)," jakaa kortit"):2===e.phase?e.myTurn?i.a.createElement("div",null,"Sin\xe4 aloitat. Kun kaikki ovat j\xe4rjest\xe4neet korttinsa ja ovat valmiita, voit avata yhden kortin pakasta."):i.a.createElement("div",null,i.a.createElement("span",null,e.players[e.playerInTurn].name)," aloittaa. J\xe4rjest\xe4 kortit ja ole valmis, kun peli alkaa."):3===e.phase||3.2===e.phase?e.myTurn?i.a.createElement("div",null,"Nosta kortti pakasta tai avopakasta klikkaamalla"):i.a.createElement("div",null,i.a.createElement("span",null,e.players[e.playerInTurn].name)," nostaa",e.can.buy?". Voit yritt\xe4\xe4 ostaa kortin klikkaamalla avopakkaa.":""," "):3.1===e.phase?e.buying<0?i.a.createElement("div",null,"Haluat ostaa. ",e.players[e.playerInTurn].name," miettii."):e.can.sell?i.a.createElement("div",null,e.players[e.buying].name," haluaa ostaa."):i.a.createElement("div",null,e.players[e.buying].name," haluaa ostaa. ",e.players[e.playerInTurn].name," miettii."):4===e.phase?e.myTurn?e.can.open&&!this.state.opening?i.a.createElement("div",null,"Pelaa vuoro ja laita lopuksi kortti avopakkaan"):this.state.opening?i.a.createElement("div",null,"Valitse ",this.state.s.round.roundName):i.a.createElement("div",null,"Pelaa vuoro ja laita lopuksi kortti avopakkaan"):i.a.createElement("div",null,i.a.createElement("span",null,e.players[e.playerInTurn].name)," pelaa vuoroaan."):5===e.phase?e.winner<0?i.a.createElement("div",{className:"winner"},"Sin\xe4 voitit t\xe4m\xe4n kierroksen!"):i.a.createElement("div",{className:"winner"},i.a.createElement("span",null,e.players[e.winner].name)," voitti t\xe4m\xe4n kierroksen"):""}},{key:"createControls",value:function(){var e=this,t=this.state.s;return t.can.deal?i.a.createElement("button",{onClick:function(){return e.props.stateManager.sendAction("deal")}},"Jaa kortit"):t.can.show?i.a.createElement("button",{onClick:function(){return e.props.stateManager.sendAction("showCard")}},"Avaa kortti"):t.can.sell?i.a.createElement("div",null,i.a.createElement("button",{onClick:function(){return e.props.stateManager.sendAction("sell")}},"Myyn"),i.a.createElement("button",{onClick:function(){return e.props.stateManager.sendAction("dontsell")}},"En myy")):t.can.open&&!this.state.opening?i.a.createElement("button",{onClick:function(){return e.startOpening()}},"Avaan"):this.state.opening?i.a.createElement("div",null,i.a.createElement("button",{onClick:function(){return e.confirmOpening()},disabled:!this.state.selectionOk},"Avaa valitut"),i.a.createElement("button",{onClick:function(){return e.cancelOpening()}},"En avaakaan")):t.can.startNextRound?i.a.createElement("button",{onClick:function(){return e.props.onNextRound()}},"Aloita seuraava kierros"):t.can.endGame?i.a.createElement("button",{onClick:function(){return e.props.onEndGame()}},"Sulje peli"):""}},{key:"render",value:function(){if(console.log(this.state.s),!this.props.canStart||!this.state.s||6===this.state.s.phase)return i.a.createElement("div",{className:"CardTable"});console.log(this.state.s);var e=null===this.state.s.myhands||void 0===this.state.s.myhands.open;return i.a.createElement("div",{className:"CardTable "+(this.state.opening?"selecting":"")+(this.state.s.myhands&&this.state.s.myhands.inTurn?" in-turn":"")},i.a.createElement("div",{id:"otherplayers"},this.createPlayers()),i.a.createElement("div",{id:"gamearea",className:"turn-indicator "+(this.state.s.myhands&&this.state.s.myhands.inTurn?"in-turn":"")},i.a.createElement("div",{id:"roundinfo"},"Kierros ",this.state.s.round.roundNumber,"/8 \u2013 ",this.state.s.round.roundName),i.a.createElement("div",{id:"instructions"},this.createInstructions()),i.a.createElement("div",{id:"deckrow"},i.a.createElement("div",{id:"deckandpile"},i.a.createElement("div",{id:"deck"}),i.a.createElement("div",{id:"pile"})),e?"":i.a.createElement("div",{id:"deckrowcolumn2"},this.state.s.myhands.open.map((function(e,t){return i.a.createElement(y,{key:"m"+t,id:"myopen"+t,classes:"player-hand open-hand"})})),i.a.createElement("div",{id:"controls"},this.createControls()))),e?"":i.a.createElement("div",{id:"my-closed-hand-sections",className:"turn-indicator "+(this.state.s.myhands&&this.state.s.myhands.inTurn?"in-turn":"")},i.a.createElement("div",{id:"section-template",className:"section",style:{display:"none"}}),this.createMySections(),i.a.createElement("div",{id:"newsection",className:"new-section",style:{visibility:this.state.s.phase>=2&&this.state.s.phase<=4?"visible":"hidden"}},i.a.createElement("div",null,"+")))))}}]),a}(n.Component),w=function(e){Object(d.a)(a,e);var t=Object(l.a)(a);function a(){var e;return Object(r.a)(this,a),(e=t.call(this)).onStateChange=function(){var t=e.props.stateManager.getState();e.setState({game:t.game})},e.onScoreBoardClosed=function(){e.setState({canStart:!0})},e.onStartGame=function(){e.setState({canStart:!0}),e.props.stateManager.sendGameAction("startGame")},e.onNextRound=function(){e.props.stateManager.sendGameAction("nextRound")},e.onEndGame=function(){e.props.stateManager.sendGameAction("endGame")},e.state={canStart:!1},e}return Object(c.a)(a,[{key:"componentDidMount",value:function(){this.props.stateManager.subscribeTo("stateChange",this.onStateChange)}},{key:"componentWillUnmount",value:function(){this.props.stateManager.unsubscribe("stateChange",this.onStateChange)}},{key:"componentDidUpdate",value:function(){}},{key:"render",value:function(){return i.a.createElement("div",{className:"GameRoom"},i.a.createElement(f,{game:this.state.game,onStartGame:this.onStartGame,onAbandonGame:this.props.abandonGame,onExitGame:this.props.exitGame}),i.a.createElement(G,{goToGame:this.props.goToGame,onNextRound:this.onNextRound,onEndGame:this.onEndGame,canStart:this.state.game&&this.state.game.locked,stateManager:this.props.stateManager}))}}]),a}(n.Component),x=a(20),j=a.n(x),N=a(41),M=a(21),O=a.n(M),T=function(){function e(){Object(r.a)(this,e),this.endpoint="localhost"===window.location.hostname?"http://localhost:4000":""}return Object(c.a)(e,[{key:"initLobby",value:function(){var e=Object(N.a)(j.a.mark((function e(t,a){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("initLobby",t),this.lobby&&(this.lobby.close(),this.lobby=null),e.next=4,O()(this.endpoint+"/lobby");case 4:this.lobby=e.sent,this.lobby.on("connect",(function(){console.log("connected to lobby"),a({connected:!0,msg:"Yhteys ok"})})),this.lobby.on("reconnect",(function(){console.log("reconnected to lobby")})),this.lobby.on("reconnect_attempt",(function(e){console.log("attempting to reconnect to lobby",e)})),this.lobby.on("disconnect",(function(){console.log("disconnected from lobby")}));case 9:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"findGame",value:function(e,t){this.lobby.emit("findGame",{code:e},(function(e){console.log("findGame result",e),t(e)}))}},{key:"createGame",value:function(e,t){this.lobby.emit("createGame",{nick:e},(function(e){console.log("createGame result",e),t(e)}))}},{key:"joinGame",value:function(e,t,a){this.lobby.emit("joinGame",{game:e,nick:t},(function(e){console.log("joinGame result",e),a(e)}))}},{key:"resumeParticipation",value:function(e,t){this.lobby.emit("resumeParticipation",{participation:e},(function(e){console.log("resumeParticipation result",e),t(e)}))}},{key:"initGame",value:function(e,t,a){var n=this;console.log("initGame",e,t),this.game=O()(this.endpoint+"/game/"+e),this.game.on("stateChange",(function(e){n.stateChange(e)})),this.game.on("connect",(function(){console.log("connected"),n.authenticate(t,a)})),this.game.on("reconnect",(function(){console.log("reconnected")})),this.game.on("reconnect_attempt",(function(e){console.log("attempting to reconnect",e)})),this.game.on("disconnect",(function(){console.log("disconnected")})),this.game.on("authenticated",(function(){n.requestFullState(),a({connected:!0,authenticated:!0,msg:"Yhteys ok"})}))}},{key:"closeGame",value:function(){this.game&&(this.game.close(),this.game=null)}},{key:"authenticate",value:function(e,t){this.game.emit("authenticate",e,(function(e){return t(e)}))}},{key:"requestFullState",value:function(){this.game.emit("state")}},{key:"getState",value:function(){return this.state}},{key:"stateChange",value:function(e){switch(console.log("StateManager.stateChange",e),e.action){case"fullState":this.state=e.state;var t=new CustomEvent("stateChange",{detail:{action:"fullState",state:e.state}});document.dispatchEvent(t)}}},{key:"validateSelection",value:function(e,t){console.log("validateSelection",e),this.game.emit("validateSelection",{selectedIndices:e},t)}},{key:"sendAction",value:function(e,t){console.log("sendAction",e,t),t=t||{},this.game.emit("action",Object(u.a)({},t,{action:e}))}},{key:"exitGame",value:function(){this.game.emit("exitGame")}},{key:"abandonGame",value:function(){this.game.emit("abandonGame")}},{key:"sendGameAction",value:function(e,t){console.log("sendGameAction",e,t),t=t||{},this.game.emit("gameAction",Object(u.a)({},t,{action:e}))}},{key:"subscribeTo",value:function(e,t){document.addEventListener(e,t)}},{key:"unsubscribe",value:function(e,t){document.removeEventListener(e,t)}}]),e}(),I=function(e){Object(d.a)(a,e);var t=Object(l.a)(a);function a(){var e;return Object(r.a)(this,a),(e=t.call(this)).goToGame=function(t,a){console.log("goToGame",t,a),e.stateManager.initGame(t,{participation:a},(function(t){e.setState({inLobby:!1,inGame:!0,myName:t.myName,authenticated:!0}),console.log("App.callback",t)}))},e.exitGame=function(){console.log("exitGame"),e.setState({inLobby:!0,inGame:!1}),e.stateManager.exitGame(),g.resetState(),e.stateManager.closeGame()},e.abandonGame=function(){console.log("abandonGame"),e.setState({inLobby:!0,inGame:!1}),e.stateManager.abandonGame(),g.resetState(),e.stateManager.closeGame()},e.stateManager=new T,e.state={inLobby:!0,inGame:!1,myName:null},e}return Object(c.a)(a,[{key:"componentDidMount",value:function(){var e=this,t=window.location.search;t&&decodeURIComponent(t.substring(1));this.stateManager.initLobby("lobby",(function(t){e.setState({lobbyReady:!0}),console.log("In the lobby",t)}))}},{key:"render",value:function(){return document.title="Islanti",i.a.createElement("div",{className:"App"},this.state.inLobby?i.a.createElement(g,{stateManager:this.stateManager,goToGame:this.goToGame,lobbyReady:this.state.lobbyReady}):"",this.state.inGame?i.a.createElement(w,{stateManager:this.stateManager,abandonGame:this.abandonGame,exitGame:this.exitGame}):"")}}]),a}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(i.a.createElement(i.a.StrictMode,null,i.a.createElement(I,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[43,1,2]]]);
//# sourceMappingURL=main.d2a674fa.chunk.js.map